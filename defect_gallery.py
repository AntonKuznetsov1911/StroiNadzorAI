"""
–ì–∞–ª–µ—Ä–µ—è —Ç–∏–ø–∏—á–Ω—ã—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤ v3.4
–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ—Ñ–µ–∫—Ç–∞—Ö —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
"""

from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ContextTypes
import logging

logger = logging.getLogger(__name__)


# ========================================
# –ö–ê–¢–ï–ì–û–†–ò–ò –î–ï–§–ï–ö–¢–û–í
# ========================================

DEFECT_CATEGORIES = {
    "cracks": {
        "name": "üî¥ –¢—Ä–µ—â–∏–Ω—ã",
        "icon": "üî¥",
        "description": "–¢—Ä–µ—â–∏–Ω—ã –≤ –±–µ—Ç–æ–Ω–µ, –∫–∏—Ä–ø–∏—á–µ, —à—Ç—É–∫–∞—Ç—É—Ä–∫–µ"
    },
    "corrosion": {
        "name": "üü† –ö–æ—Ä—Ä–æ–∑–∏—è",
        "icon": "üü†",
        "description": "–ö–æ—Ä—Ä–æ–∑–∏—è –∞—Ä–º–∞—Ç—É—Ä—ã, –º–µ—Ç–∞–ª–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π"
    },
    "leaks": {
        "name": "üíß –ü—Ä–æ—Ç–µ—á–∫–∏",
        "icon": "üíß",
        "description": "–ü—Ä–æ—Ç–µ—á–∫–∏ –∫—Ä–æ–≤–ª–∏, —Å—Ç–µ–Ω, —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞"
    },
    "deformation": {
        "name": "üìê –î–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏",
        "icon": "üìê",
        "description": "–ü—Ä–æ–≥–∏–±—ã, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è, –ø–µ—Ä–µ–∫–æ—Å—ã"
    },
    "surface": {
        "name": "üé® –î–µ—Ñ–µ–∫—Ç—ã –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏",
        "icon": "üé®",
        "description": "–í—ã—Å–æ–ª—ã, —à–µ–ª—É—à–µ–Ω–∏–µ, –æ—Ç—Å–ª–æ–µ–Ω–∏–µ"
    },
    "joints": {
        "name": "üîó –®–≤—ã –∏ —Å—Ç—ã–∫–∏",
        "icon": "üîó",
        "description": "–î–µ—Ñ–µ–∫—Ç—ã —à–≤–æ–≤, —Å—Ç—ã–∫–æ–≤, –ø—Ä–∏–º—ã–∫–∞–Ω–∏–π"
    }
}


# ========================================
# –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô –û –î–ï–§–ï–ö–¢–ê–•
# ========================================

DEFECTS_DATABASE = {
    # ===== –¢–†–ï–©–ò–ù–´ =====
    "cracks": {
        "shrinkage_cracks": {
            "name": "–£—Å–∞–¥–æ—á–Ω—ã–µ —Ç—Ä–µ—â–∏–Ω—ã",
            "description": "–°–µ—Ç–∫–∞ –º–µ–ª–∫–∏—Ö —Ç—Ä–µ—â–∏–Ω –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –±–µ—Ç–æ–Ω–∞",
            "causes": [
                "–ë—ã—Å—Ç—Ä–æ–µ –≤—ã—Å—ã—Ö–∞–Ω–∏–µ –±–µ—Ç–æ–Ω–∞",
                "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —É—Ö–æ–¥ –ø–æ—Å–ª–µ —É–∫–ª–∞–¥–∫–∏",
                "–í—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø—Ä–∏ —Ç–≤–µ—Ä–¥–µ–Ω–∏–∏",
                "–ò–∑–±—ã—Ç–æ–∫ –≤–æ–¥—ã –≤ —Å–º–µ—Å–∏"
            ],
            "how_to_identify": [
                "–ü–æ—è–≤–ª—è—é—Ç—Å—è –≤ –ø–µ—Ä–≤—ã–µ 1-7 –¥–Ω–µ–π",
                "–®–∏—Ä–∏–Ω–∞ 0.1-0.5 –º–º",
                "–°–µ—Ç—á–∞—Ç—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä",
                "–ù–µ–≥–ª—É–±–æ–∫–∏–µ (–¥–æ 5 –º–º)"
            ],
            "danger_level": "–ù–∏–∑–∫–∞—è",
            "standards": ["–°–ü 63.13330.2018 –ø.7.3.8", "–°–ü 28.13330.2017 –ø.5.2"],
            "solutions": [
                "–ò–Ω—ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ø–æ–∫—Å–∏–¥–Ω—ã–º–∏ —Å–æ—Å—Ç–∞–≤–∞–º–∏",
                "–ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–∞—è –≥–µ—Ä–º–µ—Ç–∏–∑–∞—Ü–∏—è",
                "–®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ –ø–æ —Å–µ—Ç–∫–µ"
            ],
            "prevention": [
                "–£–∫—Ä—ã—Ç–∏–µ –±–µ—Ç–æ–Ω–∞ –ø–ª—ë–Ω–∫–æ–π",
                "–í–ª–∞–∂–Ω—ã–π —É—Ö–æ–¥ 7-14 –¥–Ω–µ–π",
                "–ü—Ä–æ—Ç–∏–≤–æ—É—Å–∞–¥–æ—á–Ω—ã–µ –¥–æ–±–∞–≤–∫–∏",
                "–ê—Ä–º–∏—Ä—É—é—â–∞—è —Å–µ—Ç–∫–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–º —Å–ª–æ–µ"
            ]
        },
        "structural_cracks": {
            "name": "–°–∏–ª–æ–≤—ã–µ —Ç—Ä–µ—â–∏–Ω—ã",
            "description": "–ì–ª—É–±–æ–∫–∏–µ —Ç—Ä–µ—â–∏–Ω—ã –æ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–æ–∫",
            "causes": [
                "–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
                "–û—à–∏–±–∫–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
                "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ",
                "–ü—Ä–æ—Å–∞–¥–∫–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞"
            ],
            "how_to_identify": [
                "–®–∏—Ä–∏–Ω–∞ > 1 –º–º",
                "–°–∫–≤–æ–∑–Ω—ã–µ —Ç—Ä–µ—â–∏–Ω—ã",
                "–ü—Ä–æ–¥–æ–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–¥–æ–ª—å —ç–ª–µ–º–µ–Ω—Ç–∞",
                "–†–∞—Å–∫—Ä—ã—Ç–∏–µ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π"
            ],
            "danger_level": "–í—ã—Å–æ–∫–∞—è ‚ö†Ô∏è",
            "standards": ["–°–ü 63.13330.2018 –ø.8.2", "–ì–û–°–¢ 31937-2011"],
            "solutions": [
                "–û–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –Ω–µ—Å—É—â–µ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
                "–£—Å–∏–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π",
                "–ò–Ω—ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–∏–º–µ—Ä–∞–º–∏",
                "–†–∞–∑–≥—Ä—É–∑–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞"
            ],
            "prevention": [
                "–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç",
                "–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ",
                "–ö–æ–Ω—Ç—Ä–æ–ª—å –æ—Å–∞–¥–∫–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞",
                "–ó–∞–ø–∞—Å –ø—Ä–æ—á–Ω–æ—Å—Ç–∏ 30%"
            ]
        },
        "temperature_cracks": {
            "name": "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ—â–∏–Ω—ã",
            "description": "–¢—Ä–µ—â–∏–Ω—ã –æ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã—Ö –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–π",
            "causes": [
                "–°—É—Ç–æ—á–Ω—ã–µ –ø–µ—Ä–µ–ø–∞–¥—ã —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä",
                "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã—Ö —à–≤–æ–≤",
                "–ñ—ë—Å—Ç–∫–æ–µ –∑–∞—â–µ–º–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤",
                "–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π –ø—Ä–æ–≥—Ä–µ–≤ –º–∞—Å—Å–∏–≤–∞"
            ],
            "how_to_identify": [
                "–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –ø–æ–ø–µ—Ä—ë–∫ —ç–ª–µ–º–µ–Ω—Ç–∞",
                "–ò–∑–º–µ–Ω—è—é—Ç —à–∏—Ä–∏–Ω—É –ø—Ä–∏ t¬∞",
                "–ü–æ—è–≤–ª—è—é—Ç—Å—è –≤ –º–∞—Å—Å–∏–≤–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö",
                "–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å ~10-30 –º"
            ],
            "danger_level": "–°—Ä–µ–¥–Ω—è—è",
            "standards": ["–°–ü 28.13330.2017 –ø.10.3", "–°–ü 70.13330.2012"],
            "solutions": [
                "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã—Ö —à–≤–æ–≤",
                "–ì–µ—Ä–º–µ—Ç–∏–∑–∞—Ü–∏—è —à–≤–æ–≤",
                "–≠–ª–∞—Å—Ç–∏—á–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª–∏",
                "–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞—Å–∫—Ä—ã—Ç–∏—è"
            ],
            "prevention": [
                "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ —à–≤—ã –∫–∞–∂–¥—ã–µ 30 –º",
                "–î–µ—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤—Å—Ç–∞–≤–∫–∏",
                "–°–∫–æ–ª—å–∑—è—â–∏–µ –æ–ø–æ—Ä—ã",
                "–¢–µ—Ä–º–æ–∏–∑–æ–ª—è—Ü–∏—è –º–∞—Å—Å–∏–≤–æ–≤"
            ]
        }
    },

    # ===== –ö–û–†–†–û–ó–ò–Ø =====
    "corrosion": {
        "rebar_corrosion": {
            "name": "–ö–æ—Ä—Ä–æ–∑–∏—è –∞—Ä–º–∞—Ç—É—Ä—ã",
            "description": "–†–∂–∞–≤—á–∏–Ω–∞ –Ω–∞ –∞—Ä–º–∞—Ç—É—Ä–Ω—ã—Ö —Å—Ç–µ—Ä–∂–Ω—è—Ö",
            "causes": [
                "–ú–∞–ª—ã–π –∑–∞—â–∏—Ç–Ω—ã–π —Å–ª–æ–π –±–µ—Ç–æ–Ω–∞",
                "–¢—Ä–µ—â–∏–Ω—ã –≤ –±–µ—Ç–æ–Ω–µ",
                "–ü—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ —Ö–ª–æ—Ä–∏–¥–æ–≤",
                "–ö–∞—Ä–±–æ–Ω–∏–∑–∞—Ü–∏—è –±–µ—Ç–æ–Ω–∞"
            ],
            "how_to_identify": [
                "–†–∂–∞–≤—ã–µ –ø–æ—Ç—ë–∫–∏ –Ω–∞ –±–µ—Ç–æ–Ω–µ",
                "–í–∑–¥—É—Ç–∏–µ –∑–∞—â–∏—Ç–Ω–æ–≥–æ —Å–ª–æ—è",
                "–û—Ç—Å–ª–æ–µ–Ω–∏–µ –±–µ—Ç–æ–Ω–∞",
                "–£–º–µ–Ω—å—à–µ–Ω–∏–µ —Å–µ—á–µ–Ω–∏—è –∞—Ä–º–∞—Ç—É—Ä—ã"
            ],
            "danger_level": "–í—ã—Å–æ–∫–∞—è ‚ö†Ô∏è",
            "standards": ["–°–ü 28.13330.2017 –ø.9.1", "–ì–û–°–¢ 31384-2017"],
            "solutions": [
                "–í—Å–∫—Ä—ã—Ç–∏–µ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–æ–≥–æ —Å–ª–æ—è",
                "–û—á–∏—Å—Ç–∫–∞ –∞—Ä–º–∞—Ç—É—Ä—ã –æ—Ç —Ä–∂–∞–≤—á–∏–Ω—ã",
                "–ê–Ω—Ç–∏–∫–æ—Ä—Ä–æ–∑–∏–π–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞",
                "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç–Ω–æ–≥–æ —Å–ª–æ—è"
            ],
            "prevention": [
                "–ó–∞—â–∏—Ç–Ω—ã–π —Å–ª–æ–π ‚â• 20 –º–º",
                "–ü–ª–æ—Ç–Ω—ã–π –±–µ—Ç–æ–Ω W6-W8",
                "–ì–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π",
                "–ò–Ω–≥–∏–±–∏—Ç–æ—Ä—ã –∫–æ—Ä—Ä–æ–∑–∏–∏ –≤ –±–µ—Ç–æ–Ω–µ"
            ]
        },
        "steel_corrosion": {
            "name": "–ö–æ—Ä—Ä–æ–∑–∏—è –º–µ—Ç–∞–ª–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π",
            "description": "–†–∂–∞–≤—á–∏–Ω–∞ –Ω–∞ —Å—Ç–∞–ª—å–Ω—ã—Ö –±–∞–ª–∫–∞—Ö, –∫–æ–ª–æ–Ω–Ω–∞—Ö",
            "causes": [
                "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–Ω—Ç–∏–∫–æ—Ä—Ä–æ–∑–∏–π–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è",
                "–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞—â–∏—Ç–Ω–æ–≥–æ —Å–ª–æ—è",
                "–ö–æ–Ω–¥–µ–Ω—Å–∞—Ç, –≤–ª–∞–∂–Ω–æ—Å—Ç—å",
                "–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å—Ä–µ–¥–∞"
            ],
            "how_to_identify": [
                "–†–∂–∞–≤—á–∏–Ω–∞ –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏",
                "–Ø–∑–≤–µ–Ω–Ω–∞—è –∫–æ—Ä—Ä–æ–∑–∏—è",
                "–°–∫–≤–æ–∑–Ω–∞—è –∫–æ—Ä—Ä–æ–∑–∏—è",
                "–£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ç–æ–ª—â–∏–Ω—ã –º–µ—Ç–∞–ª–ª–∞"
            ],
            "danger_level": "–í—ã—Å–æ–∫–∞—è ‚ö†Ô∏è",
            "standards": ["–°–ü 28.13330.2017 –ø.14.1", "–ì–û–°–¢ 9.402-2004"],
            "solutions": [
                "–£–¥–∞–ª–µ–Ω–∏–µ —Ä–∂–∞–≤—á–∏–Ω—ã (–ø–µ—Å–∫–æ—Å—Ç—Ä—É–π)",
                "–ì—Ä—É–Ω—Ç–æ–≤–∫–∞ –ì–§-021, –≠–ü-0010",
                "–ü–æ–∫—Ä–∞—Å–∫–∞ –≤ 2-3 —Å–ª–æ—è",
                "–ó–∞–º–µ–Ω–∞ —Å–∏–ª—å–Ω–æ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤"
            ],
            "prevention": [
                "–ó–∞–≤–æ–¥—Å–∫–æ–µ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ",
                "–†–µ–≥—É–ª—è—Ä–Ω–∞—è –∏–Ω—Å–ø–µ–∫—Ü–∏—è",
                "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è —Ä–∞–∑ –≤ 5 –ª–µ—Ç",
                "–ö–∞—Ç–æ–¥–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤–æ –≤–ª–∞–∂–Ω–æ–π —Å—Ä–µ–¥–µ"
            ]
        }
    },

    # ===== –ü–†–û–¢–ï–ß–ö–ò =====
    "leaks": {
        "roof_leaks": {
            "name": "–ü—Ä–æ—Ç–µ—á–∫–∏ –∫—Ä–æ–≤–ª–∏",
            "description": "–ü—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –≤–æ–¥—ã —á–µ—Ä–µ–∑ –∫—Ä–æ–≤–µ–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ",
            "causes": [
                "–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –≥–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏–∏",
                "–ù–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–≤—ã",
                "–ó–∞—Å–æ—Ä –≤–æ–¥–æ—Å—Ç–æ–∫–æ–≤",
                "–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è"
            ],
            "how_to_identify": [
                "–ú–æ–∫—Ä—ã–µ –ø—è—Ç–Ω–∞ –Ω–∞ –ø–æ—Ç–æ–ª–∫–µ",
                "–ö–∞–ø–ª–∏ –≤–æ –≤—Ä–µ–º—è –¥–æ–∂–¥—è",
                "–ü–ª–µ—Å–µ–Ω—å, –≥—Ä–∏–±–æ–∫",
                "–í–∑–¥—É—Ç–∏–µ –∫—Ä–æ–≤–ª–∏"
            ],
            "danger_level": "–°—Ä–µ–¥–Ω—è—è",
            "standards": ["–°–ü 17.13330.2017", "–°–ù–∏–ü II-26-76"],
            "solutions": [
                "–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–º–æ–Ω—Ç –Ω–∞–ø–ª–∞–≤–ª–µ–Ω–∏–µ–º",
                "–ó–∞–ø–ª–∞—Ç—ã –∏–∑ —Ä—É–±–µ—Ä–æ–∏–¥–∞",
                "–ì–µ—Ä–º–µ—Ç–∏–∑–∞—Ü–∏—è —à–≤–æ–≤",
                "–ó–∞–º–µ–Ω–∞ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞"
            ],
            "prevention": [
                "–†–µ–≥—É–ª—è—Ä–Ω—ã–π –æ—Å–º–æ—Ç—Ä 2 —Ä–∞–∑–∞ –≤ –≥–æ–¥",
                "–û—á–∏—Å—Ç–∫–∞ –≤–æ–¥–æ—Å—Ç–æ–∫–æ–≤",
                "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º—ã–∫–∞–Ω–∏–π",
                "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —É–∫–ª–∞–¥–∫–∞ –ø—Ä–∏ –º–æ–Ω—Ç–∞–∂–µ"
            ]
        },
        "basement_leaks": {
            "name": "–ü—Ä–æ—Ç–µ—á–∫–∏ –≤ –ø–æ–¥–≤–∞–ª–µ",
            "description": "–ü—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –≥—Ä—É–Ω—Ç–æ–≤—ã—Ö –≤–æ–¥",
            "causes": [
                "–ù–∞—Ä—É—à–µ–Ω–∏–µ –≥–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏–∏",
                "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≥—Ä—É–Ω—Ç–æ–≤—ã—Ö –≤–æ–¥",
                "–¢—Ä–µ—â–∏–Ω—ã –≤ —Å—Ç–µ–Ω–∞—Ö",
                "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—Ä–µ–Ω–∞–∂–∞"
            ],
            "how_to_identify": [
                "–ú–æ–∫—Ä—ã–µ —Å—Ç–µ–Ω—ã",
                "–õ—É–∂–∏ –Ω–∞ –ø–æ–ª—É",
                "–í—ã—Å–æ–ª—ã –Ω–∞ –±–µ—Ç–æ–Ω–µ",
                "–ó–∞–ø–∞—Ö —Å—ã—Ä–æ—Å—Ç–∏"
            ],
            "danger_level": "–í—ã—Å–æ–∫–∞—è ‚ö†Ô∏è",
            "standards": ["–°–ü 28.13330.2017", "–°–ü 104.13330.2016"],
            "solutions": [
                "–ò–Ω—ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ—â–∏–Ω",
                "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≥–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è",
                "–î—Ä–µ–Ω–∞–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",
                "–ì–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è —Å–Ω–∞—Ä—É–∂–∏ (–ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)"
            ],
            "prevention": [
                "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ",
                "–ü—Ä–∏—Å—Ç–µ–Ω–Ω—ã–π –¥—Ä–µ–Ω–∞–∂",
                "–û—Ç–º–æ—Å—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ –∑–¥–∞–Ω–∏—è",
                "–õ–∏–≤–Ω–µ–≤–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è"
            ]
        }
    },

    # ===== –î–ï–§–û–†–ú–ê–¶–ò–ò =====
    "deformation": {
        "beam_deflection": {
            "name": "–ü—Ä–æ–≥–∏–± –±–∞–ª–æ–∫ –∏ –ø–ª–∏—Ç",
            "description": "–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –ø—Ä–æ–≥–∏–±–∞",
            "causes": [
                "–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞",
                "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∂—ë—Å—Ç–∫–æ—Å—Ç—å",
                "–ü–æ–ª–∑—É—á–µ—Å—Ç—å –±–µ—Ç–æ–Ω–∞",
                "–û—à–∏–±–∫–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
            ],
            "how_to_identify": [
                "–í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–∏–±",
                "–¢—Ä–µ—â–∏–Ω—ã –≤ –Ω–∏–∂–Ω–µ–π –∑–æ–Ω–µ",
                "–ó–∞–∑–æ—Ä—ã —É –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫",
                "–ò–∑–º–µ—Ä–µ–Ω–∏–µ –Ω–∏–≤–µ–ª–∏—Ä–æ–º"
            ],
            "danger_level": "–°—Ä–µ–¥–Ω—è—è",
            "standards": ["–°–ü 63.13330.2018 —Ç–∞–±–ª.–ï.1", "–°–ü 20.13330.2016"],
            "solutions": [
                "–£—Å–∏–ª–µ–Ω–∏–µ –±–∞–ª–∫–∏ —Å–Ω–∏–∑—É",
                "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–æ—Ä",
                "–†–∞–∑–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
                "–ö–æ–º–ø–æ–∑–∏—Ç–Ω–æ–µ —É—Å–∏–ª–µ–Ω–∏–µ"
            ],
            "prevention": [
                "–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –∂—ë—Å—Ç–∫–æ—Å—Ç–∏",
                "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ",
                "–ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–≥–∏–±–æ–≤ –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ",
                "–ó–∞–ø–∞—Å –ø–æ –∂—ë—Å—Ç–∫–æ—Å—Ç–∏"
            ]
        },
        "wall_tilt": {
            "name": "–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Å—Ç–µ–Ω –æ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª–∏",
            "description": "–ù–∞–∫–ª–æ–Ω —Å—Ç–µ–Ω, –∫–æ–ª–æ–Ω–Ω",
            "causes": [
                "–ü—Ä–æ—Å–∞–¥–∫–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞",
                "–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –æ—Å–∞–¥–∫–∞",
                "–û—à–∏–±–∫–∏ –º–æ–Ω—Ç–∞–∂–∞",
                "–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏"
            ],
            "how_to_identify": [
                "–í–∏–∑—É–∞–ª—å–Ω—ã–π –Ω–∞–∫–ª–æ–Ω",
                "–ò–∑–º–µ—Ä–µ–Ω–∏–µ –æ—Ç–≤–µ—Å–æ–º/—Ç–µ–æ–¥–æ–ª–∏—Ç–æ–º",
                "–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –¥–æ–ø—É—Å–∫–∞ 10 –º–º –Ω–∞ —ç—Ç–∞–∂",
                "–¢—Ä–µ—â–∏–Ω—ã –≤ –º–µ—Å—Ç–∞—Ö –∑–∞—â–µ–º–ª–µ–Ω–∏—è"
            ],
            "danger_level": "–í—ã—Å–æ–∫–∞—è ‚ö†Ô∏è",
            "standards": ["–°–ü 70.13330.2012 —Ç–∞–±–ª.8.5", "–ì–û–°–¢ 22266-2013"],
            "solutions": [
                "–û–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞",
                "–£—Å–∏–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π",
                "–í—ã–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
                "–†–∞–∑–≥—Ä—É–∑–∫–∞ –≤–µ—Ä—Ö–Ω–∏—Ö —ç—Ç–∞–∂–µ–π"
            ],
            "prevention": [
                "–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –º–æ–Ω—Ç–∞–∂–µ",
                "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç",
                "–ì–µ–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥",
                "–ñ—ë—Å—Ç–∫–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏"
            ]
        }
    },

    # ===== –î–ï–§–ï–ö–¢–´ –ü–û–í–ï–†–•–ù–û–°–¢–ò =====
    "surface": {
        "efflorescence": {
            "name": "–í—ã—Å–æ–ª—ã",
            "description": "–ë–µ–ª—ã–π –Ω–∞–ª—ë—Ç –Ω–∞ –∫–∏—Ä–ø–∏—á–µ, –±–µ—Ç–æ–Ω–µ",
            "causes": [
                "–ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–ª–µ–π —Å –≤–æ–¥–æ–π",
                "–ù–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∏—Ä–ø–∏—á",
                "–ü—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ –≤–ª–∞–≥–∏",
                "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏–∏"
            ],
            "how_to_identify": [
                "–ë–µ–ª—ã–π/–∂—ë–ª—Ç—ã–π –Ω–∞–ª—ë—Ç",
                "–ü–æ—Ä–æ—à–∫–æ–æ–±—Ä–∞–∑–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞",
                "–ü–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–∂–¥—è",
                "–õ–µ–≥–∫–æ —Å—Ç–∏—Ä–∞–µ—Ç—Å—è"
            ],
            "danger_level": "–ù–∏–∑–∫–∞—è",
            "standards": ["–ì–û–°–¢ 530-2012", "–°–ü 15.13330.2020"],
            "solutions": [
                "–û—á–∏—Å—Ç–∫–∞ —â—ë—Ç–∫–æ–π + –≤–æ–¥–∞",
                "–ö–∏—Å–ª–æ—Ç–Ω—ã–µ —Å–æ—Å—Ç–∞–≤—ã (10% HCl)",
                "–ì–∏–¥—Ä–æ—Ñ–æ–±–∏–∑–∞—Ü–∏—è",
                "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤–ª–∞–≥–∏"
            ],
            "prevention": [
                "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∏—Ä–ø–∏—á",
                "–ì–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è —Ü–æ–∫–æ–ª—è",
                "–ö–æ–∑—ã—Ä—å–∫–∏ –Ω–∞–¥ –∫–ª–∞–¥–∫–æ–π",
                "–ì–∏–¥—Ä–æ—Ñ–æ–±–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞"
            ]
        },
        "spalling": {
            "name": "–®–µ–ª—É—à–µ–Ω–∏–µ –±–µ—Ç–æ–Ω–∞",
            "description": "–û—Ç—Å–ª–æ–µ–Ω–∏–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–≥–æ —Å–ª–æ—è",
            "causes": [
                "–ó–∞–º–µ—Ä–∑–∞–Ω–∏–µ –≤–ª–∞–≥–∏",
                "–ö–æ—Ä—Ä–æ–∑–∏—è –∞—Ä–º–∞—Ç—É—Ä—ã",
                "–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –±–µ—Ç–æ–Ω–∞",
                "–¶–∏–∫–ª—ã –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–Ω–∏—è-–æ—Ç—Ç–∞–∏–≤–∞–Ω–∏—è"
            ],
            "how_to_identify": [
                "–û—Ç—Å–ª–∞–∏–≤–∞—é—â–∏–µ—Å—è —á–µ—à—É–π–∫–∏",
                "–û–≥–æ–ª–µ–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
                "–†—ã—Ö–ª–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞",
                "–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—Ä—É–µ—Ç –∑–∏–º–æ–π"
            ],
            "danger_level": "–°—Ä–µ–¥–Ω—è—è",
            "standards": ["–°–ü 28.13330.2017 –ø.5.3", "–ì–û–°–¢ 10060-2012"],
            "solutions": [
                "–£–¥–∞–ª–µ–Ω–∏–µ —Ä—ã—Ö–ª–æ–≥–æ —Å–ª–æ—è",
                "–ì—Ä—É–Ω—Ç–æ–≤–∫–∞ –≥–ª—É–±–æ–∫–æ–≥–æ –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è",
                "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–º–æ–Ω—Ç–Ω—ã–º —Å–æ—Å—Ç–∞–≤–æ–º",
                "–ó–∞—â–∏—Ç–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ"
            ],
            "prevention": [
                "–ú–æ—Ä–æ–∑–æ—Å—Ç–æ–π–∫–∏–π –±–µ—Ç–æ–Ω F150+",
                "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–ø–ª–æ—Ç–Ω–µ–Ω–∏–µ",
                "–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–ª–∞–≥–∏",
                "–ì–∏–¥—Ä–æ—Ñ–æ–±–∏–∑–∞—Ç–æ—Ä—ã"
            ]
        }
    },

    # ===== –®–í–´ –ò –°–¢–´–ö–ò =====
    "joints": {
        "expansion_joint": {
            "name": "–î–µ—Ñ–µ–∫—Ç—ã –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —à–≤–æ–≤",
            "description": "–ù–∞—Ä—É—à–µ–Ω–∏–µ –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç–∏ —à–≤–æ–≤",
            "causes": [
                "–°—Ç–∞—Ä–µ–Ω–∏–µ –≥–µ—Ä–º–µ—Ç–∏–∫–∞",
                "–ß—Ä–µ–∑–º–µ—Ä–Ω—ã–µ –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏",
                "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–æ–Ω—Ç–∞–∂",
                "–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è"
            ],
            "how_to_identify": [
                "–¢—Ä–µ—â–∏–Ω—ã –≤ –≥–µ—Ä–º–µ—Ç–∏–∫–µ",
                "–û—Ç—Ä—ã–≤ –æ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏—è",
                "–ü—Ä–æ—Ç–µ—á–∫–∏ –≤ —à–≤–∞—Ö",
                "–†–∞–∑—Ä—É—à–µ–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—è"
            ],
            "danger_level": "–°—Ä–µ–¥–Ω—è—è",
            "standards": ["–°–ü 70.13330.2012 –ø.7.3", "–ì–û–°–¢ 25621-2014"],
            "solutions": [
                "–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –≥–µ—Ä–º–µ—Ç–∏–∫–∞",
                "–û—á–∏—Å—Ç–∫–∞ –∏ –æ–±–µ–∑–∂–∏—Ä–∏–≤–∞–Ω–∏–µ",
                "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–ø–ª–æ—Ç–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —à–Ω—É—Ä–∞",
                "–ù–æ–≤—ã–π –≥–µ—Ä–º–µ—Ç–∏–∫ (–ø–æ–ª–∏—É—Ä–µ—Ç–∞–Ω, —Å–∏–ª–∏–∫–æ–Ω)"
            ],
            "prevention": [
                "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
                "–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —à–≤–∞",
                "–†–µ–≥—É–ª—è—Ä–Ω—ã–π –æ—Å–º–æ—Ç—Ä",
                "–ó–∞–º–µ–Ω–∞ –∫–∞–∂–¥—ã–µ 10-15 –ª–µ—Ç"
            ]
        }
    }
}


# ========================================
# –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –ì–ê–õ–ï–†–ï–ï–ô
# ========================================

def create_categories_menu():
    """–°–æ–∑–¥–∞—Ç—å –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–µ—Ñ–µ–∫—Ç–æ–≤"""
    keyboard = []

    for cat_id, cat_data in DEFECT_CATEGORIES.items():
        icon = cat_data['icon']
        name = cat_data['name']
        keyboard.append([InlineKeyboardButton(
            f"{icon} {name}",
            callback_data=f"defcat_{cat_id}"
        )])

    return InlineKeyboardMarkup(keyboard)


def create_defects_list_menu(category_id: str):
    """–°–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–µ—Ñ–µ–∫—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    keyboard = []

    if category_id in DEFECTS_DATABASE:
        for defect_id, defect_data in DEFECTS_DATABASE[category_id].items():
            name = defect_data['name']
            danger = defect_data.get('danger_level', '')

            button_text = f"{name}"
            if "‚ö†Ô∏è" in danger:
                button_text = f"‚ö†Ô∏è {name}"

            keyboard.append([InlineKeyboardButton(
                button_text,
                callback_data=f"defect_{category_id}_{defect_id}"
            )])

    # –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    keyboard.append([InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º", callback_data="defects_back")])

    return InlineKeyboardMarkup(keyboard)


def format_defect_info(category_id: str, defect_id: str) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–µ—Ñ–µ–∫—Ç–µ"""

    if category_id not in DEFECTS_DATABASE:
        return "‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

    if defect_id not in DEFECTS_DATABASE[category_id]:
        return "‚ùå –î–µ—Ñ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"

    defect = DEFECTS_DATABASE[category_id][defect_id]

    text = f"**{defect['name']}**\n\n"
    text += f"_{defect['description']}_\n\n"

    # –£—Ä–æ–≤–µ–Ω—å –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    text += f"**üö® –£—Ä–æ–≤–µ–Ω—å –æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** {defect['danger_level']}\n\n"

    # –ü—Ä–∏—á–∏–Ω—ã
    text += "**üîç –ü—Ä–∏—á–∏–Ω—ã –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è:**\n"
    for cause in defect['causes']:
        text += f"‚Ä¢ {cause}\n"
    text += "\n"

    # –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å
    text += "**üëÅÔ∏è –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å:**\n"
    for sign in defect['how_to_identify']:
        text += f"‚Ä¢ {sign}\n"
    text += "\n"

    # –ù–æ—Ä–º–∞—Ç–∏–≤—ã
    text += "**üìö –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**\n"
    for std in defect['standards']:
        text += f"‚Ä¢ {std}\n"
    text += "\n"

    # –ú–µ—Ç–æ–¥—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è
    text += "**üîß –ú–µ—Ç–æ–¥—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è:**\n"
    for solution in defect['solutions']:
        text += f"‚Ä¢ {solution}\n"
    text += "\n"

    # –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞
    text += "**üõ°Ô∏è –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞:**\n"
    for prev in defect['prevention']:
        text += f"‚Ä¢ {prev}\n"

    return text


# ========================================
# –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î
# ========================================

async def defects_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /defects - –ø–æ–∫–∞–∑–∞—Ç—å –≥–∞–ª–µ—Ä–µ—é –¥–µ—Ñ–µ–∫—Ç–æ–≤"""

    keyboard = create_categories_menu()

    await update.message.reply_text(
        "**üì∏ –ì–ê–õ–ï–†–ï–Ø –¢–ò–ü–ò–ß–ù–´–• –î–ï–§–ï–ö–¢–û–í**\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–µ—Ñ–µ–∫—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:\n\n"
        "‚Ä¢ –û–ø–∏—Å–∞–Ω–∏–µ –∏ –ø—Ä–∏—á–∏–Ω—ã\n"
        "‚Ä¢ –ú–µ—Ç–æ–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏\n"
        "‚Ä¢ –°–ø–æ—Å–æ–±—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è\n"
        "‚Ä¢ –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è\n"
        "‚Ä¢ –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞\n\n"
        "üí° _–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –¥–µ—Ñ–µ–∫—Ç–∞, –∏ —è –ø–æ–º–æ–≥—É –µ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å!_",
        reply_markup=keyboard,
        parse_mode='Markdown'
    )


async def handle_defect_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ –≤ –≥–∞–ª–µ—Ä–µ–µ"""
    query = update.callback_query
    await query.answer()

    data = query.data

    # –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    if data == "defects_back":
        keyboard = create_categories_menu()
        await query.edit_message_text(
            "**üì∏ –ì–ê–õ–ï–†–ï–Ø –¢–ò–ü–ò–ß–ù–´–• –î–ï–§–ï–ö–¢–û–í**\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:",
            reply_markup=keyboard,
            parse_mode='Markdown'
        )
        return

    # –í—ã–±—Ä–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
    if data.startswith("defcat_"):
        category_id = data.replace("defcat_", "")

        if category_id in DEFECT_CATEGORIES:
            cat_data = DEFECT_CATEGORIES[category_id]
            keyboard = create_defects_list_menu(category_id)

            await query.edit_message_text(
                f"**{cat_data['name']}**\n\n"
                f"_{cat_data['description']}_\n\n"
                "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ—Ñ–µ–∫—Ç:",
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
        return

    # –í—ã–±—Ä–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ—Ñ–µ–∫—Ç
    if data.startswith("defect_"):
        parts = data.replace("defect_", "").split("_")
        if len(parts) >= 2:
            category_id = parts[0]
            defect_id = "_".join(parts[1:])

            info_text = format_defect_info(category_id, defect_id)

            # –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
            keyboard = [[InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É", callback_data=f"defcat_{category_id}")]]
            reply_markup = InlineKeyboardMarkup(keyboard)

            await query.edit_message_text(
                info_text,
                reply_markup=reply_markup,
                parse_mode='Markdown'
            )
        return


def get_defect_count() -> int:
    """–ü–æ–ª—É—á–∏—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ñ–µ–∫—Ç–æ–≤ –≤ –±–∞–∑–µ"""
    total = 0
    for category in DEFECTS_DATABASE.values():
        total += len(category)
    return total
