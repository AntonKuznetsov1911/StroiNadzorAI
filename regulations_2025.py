"""
База знаний по строительным требованиям 2025 года
Актуальные законы, процедуры и нормативы
"""

# === ОСНОВНЫЕ ЗАКОНЫ РФ ===
FEDERAL_LAWS = {
    "190-ФЗ": {
        "title": "Градостроительный кодекс РФ",
        "url": "http://www.consultant.ru/document/cons_doc_LAW_51040/",
        "scope": "Основной закон для всех строительных процессов",
        "key_points": [
            "Порядок выдачи разрешений на строительство",
            "Градостроительная документация",
            "Территориальное планирование"
        ]
    },
    "384-ФЗ": {
        "title": "Технический регламент о безопасности зданий и сооружений",
        "url": "http://www.consultant.ru/document/cons_doc_LAW_95720/",
        "scope": "Минимальные требования безопасности для всех объектов",
        "key_points": [
            "Механическая безопасность",
            "Пожарная безопасность",
            "Безопасность при эксплуатации"
        ]
    },
    "123-ФЗ": {
        "title": "Технический регламент о требованиях пожарной безопасности",
        "url": "http://www.consultant.ru/document/cons_doc_LAW_78699/",
        "scope": "Требования ПБ для всех объектов",
        "key_points": [
            "Классификация пожарной опасности",
            "Системы противопожарной защиты",
            "Эвакуация людей"
        ]
    },
    "116-ФЗ": {
        "title": "О промышленной безопасности ОПО",
        "url": "http://www.consultant.ru/document/cons_doc_LAW_15234/",
        "scope": "Для опасных производственных объектов",
        "key_points": [
            "Регистрация ОПО в Ростехнадзоре",
            "Классы опасности (I-IV)",
            "Экспертиза промышленной безопасности"
        ]
    },
    "214-ФЗ": {
        "title": "Об участии в долевом строительстве",
        "url": "http://www.consultant.ru/document/cons_doc_LAW_51038/",
        "scope": "Жилищное строительство",
        "key_points": [
            "Эскроу-счета (обязательно с 2019)",
            "Требования к застройщикам",
            "Права дольщиков"
        ]
    },
    "44-ФЗ": {
        "title": "О контрактной системе в сфере закупок",
        "url": "http://www.consultant.ru/document/cons_doc_LAW_144624/",
        "scope": "Госзакупки",
        "key_points": []
    },
    "223-ФЗ": {
        "title": "О закупках товаров, работ, услуг отдельными видами юридических лиц",
        "url": "http://www.consultant.ru/document/cons_doc_LAW_103979/",
        "scope": "Закупки госкорпораций",
        "key_points": []
    },
    "248-ФЗ": {
        "title": "О государственном контроле (надзоре) и муниципальном контроле в РФ",
        "url": "http://www.consultant.ru/document/cons_doc_LAW_358750/",
        "scope": "Процедуры проверок",
        "key_points": []
    }
}

# === ОБЯЗАТЕЛЬНЫЕ ПРОЦЕДУРЫ 2025 ===
MANDATORY_PROCEDURES_2025 = {
    "РНС": {
        "name": "Разрешение на строительство",
        "required_for": "Все объекты кроме ИЖС до 3 этажей",
        "authority": "Местная администрация или Минстрой РФ",
        "validity": "10 лет (можно продлить)",
        "exceptions": ["ИЖС до 3 этажей и 1500 м²"]
    },
    "Экспертиза_ПД": {
        "name": "Экспертиза проектной документации",
        "types": ["Государственная", "Негосударственная"],
        "required_for": "Объекты выше 3 этажей или >1500 м²",
        "documents": ["Положительное заключение экспертизы"],
        "timeline": "30-60 рабочих дней"
    },
    "ЗОС": {
        "name": "Заключение о соответствии",
        "authority": "Стройнадзор (региональный или федеральный)",
        "required_for": "Выдача разрешения на ввод в эксплуатацию",
        "basis": "Постановление № 1431"
    },
    "Уведомления": {
        "name": "Уведомление о начале и окончании строительства",
        "deadline_start": "За 7 дней до начала СМР",
        "deadline_end": "Не позднее дня окончания",
        "portal": "Госуслуги"
    },
    "Ввод_в_эксплуатацию": {
        "name": "Ввод в эксплуатацию",
        "model": "Реестровая (с 2022 через Госуслуги)",
        "documents": ["ЗОС", "Техплан", "Исполнительная документация"],
        "timeline": "7 рабочих дней"
    }
}

# === СРО И КВАЛИФИКАЦИЯ 2025 ===
SRO_REQUIREMENTS = {
    "Генподрядчик": {
        "sro_required": True,
        "funds": ["Компенсационный фонд возмещения", "Фонд обеспечения договорных обязательств"],
        "min_fund": "От 5 млн руб."
    },
    "Субподрядчик": {
        "sro_required": "Не требуется если сумма договора ≤ 3 млн руб. (с 2023)",
        "exception": "До 3 млн руб. - без СРО"
    },
    "ГИП": {
        "name": "Главный инженер проекта",
        "requirements": ["НОК (независимая оценка квалификации)", "Запись в НРС (национальный реестр специалистов)"],
        "level": "6-7 уровень квалификации"
    },
    "ГАП": {
        "name": "Главный архитектор проекта",
        "requirements": ["НОК", "Запись в НРС"],
        "level": "6-7 уровень квалификации"
    }
}

# === ТИМ/BIM ТРЕБОВАНИЯ ===
TIM_BIM_REQUIREMENTS = {
    "current_2022_2025": {
        "status": "Обязательно для объектов госзаказа",
        "level": "OpenBIM Level 1-2"
    },
    "future_2027": {
        "status": "Обязательно для ВСЕХ объектов капитального строительства",
        "level": "OpenBIM Level 2",
        "date": "01.01.2027"
    },
    "standards": [
        "ГОСТ Р 57580 (серия)",
        "СП 301.1325800.2017",
        "Приказ Минстроя № 926/пр"
    ],
    "software": ["Autodesk Revit", "ArchiCAD", "Allplan", "Renga", "Navisworks"]
}

# === ЦЕНООБРАЗОВАНИЕ 2025 ===
PRICING_2025 = {
    "ФГИС_ЦС": {
        "name": "Федеральная государственная информационная система ценообразования в строительстве",
        "status": "Обязательно с 2022",
        "url": "https://fgiscs.minstroyrf.ru/"
    },
    "method": "Ресурсный метод (основной с 2025)",
    "bases": ["ГЭСН-2001", "ФЕР-2001"],
    "indices": "Индексы Минстроя РФ (ежеквартально)"
}

# === ПРОМЫШЛЕННОЕ СТРОИТЕЛЬСТВО ===
INDUSTRIAL_CONSTRUCTION = {
    "ОПО_классы": {
        "I": {
            "name": "Чрезвычайно высокий",
            "examples": ["Нефтехимия", "АЭС"],
            "requirements": ["Декларация промбезопасности", "Страхование ответственности", "План ПМЛА"]
        },
        "II": {
            "name": "Высокий",
            "examples": ["Химзаводы", "Крупные склады ГСМ"],
            "requirements": ["Декларация промбезопасности", "Лицензия Ростехнадзора"]
        },
        "III": {
            "name": "Средний",
            "examples": ["Большинство производственных объектов"],
            "requirements": ["Лицензия Ростехнадзора", "План ПМЛА"]
        },
        "IV": {
            "name": "Низкий",
            "examples": ["Мелкие производства"],
            "requirements": ["Регистрация в реестре"]
        }
    },
    "обязательные_документы": {
        "СЗЗ": {
            "name": "Санитарно-защитная зона",
            "standard": "СанПиН 2.2.1/2.1.1.1200-03",
            "documents": ["Проект СЗЗ", "Заключение Роспотребнадзора"]
        },
        "Лицензия": {
            "name": "Лицензия Ростехнадзора",
            "required_for": "ОПО II-III классов"
        },
        "ПМЛА": {
            "name": "План мероприятий по локализации и ликвидации аварий",
            "required_for": "Все ОПО"
        },
        "Декларация": {
            "name": "Декларация промышленной безопасности",
            "required_for": "ОПО I-II классов"
        }
    },
    "особые_разделы_ПД": [
        "Раздел 9 - Мероприятия по обеспечению промышленной безопасности",
        "ИТМ ГОЧС (инженерно-технические мероприятия ГО и ЧС)",
        "Взрывозащита (ГОСТ IEC 60079)",
        "Молниезащита и заземление (РД 34.21.122-87, СО 153-34.21.122-2003)"
    ]
}

# === ГРАЖДАНСКОЕ СТРОИТЕЛЬСТВО ===
CIVIL_CONSTRUCTION = {
    "жилье": {
        "law": "214-ФЗ + эскроу-счета",
        "standards": ["СП 54.13330.2022 - Жилые здания", "СП 59.13330.2020 - Доступность для МГН"],
        "requirements_2025": {
            "energy_class": "Не ниже «С»",
            "smart_meters": "Обязательно (электро, тепло, вода)",
            "smart_home": ["Видеонаблюдение", "Система контроля доступа", "СОУЭ"],
            "parking": "5-10% мест для инвалидов"
        },
        "expertise": "Обязательна для домов >3 этажей или >1500 м²"
    },
    "школы_садики": {
        "standards": ["СП 251.1325800.2016 - Школы", "СП 252.1325800.2016 - Детские сады"],
        "requirements": ["Доступность для МГН", "Пожарная сигнализация", "Видеонаблюдение"]
    },
    "больницы": {
        "standards": ["СП 158.13330.2014 - Здания и помещения медорганизаций"],
        "requirements": ["Системы жизнеобеспечения", "Резервное электропитание", "Кислородные станции"]
    }
}

# === КОММЕРЧЕСКОЕ СТРОИТЕЛЬСТВО ===
COMMERCIAL_CONSTRUCTION = {
    "ТРЦ": {
        "standards": ["СП 4.13130.2013 - Самые жёсткие требования по эвакуации"],
        "requirements": [
            "2 независимых эвакуационных выхода с каждого этажа",
            "Системы дымоудаления",
            "Спринклеры",
            "СОУЭ 3-5 типа"
        ],
        "inspections": "Каждые 2 года (после пожара в 'Зимней вишне')"
    },
    "гостиницы": {
        "classification": "Обязательная по системе 'звёзды' (Приказ Минкультуры № 1215)",
        "fire_safety": "СОУЭ не ниже 3 типа",
        "standards": ["Правила предоставления гостиничных услуг"]
    },
    "апартаменты": {
        "legal_status": "Нежилые помещения",
        "advantages": ["Без 214-ФЗ и эскроу", "Упрощённое строительство"],
        "disadvantages": ["Нельзя прописаться", "Выше налог на имущество"]
    },
    "офисы": {
        "standards": ["СП 118.13330.2012 - Общественные здания"],
        "requirements": ["Доступность для МГН", "Парковка", "Инженерные системы"]
    }
}

# === КЛЮЧЕВЫЕ НОРМАТИВЫ 2025 ===
KEY_REGULATIONS_2025 = {
    "ПП_985": {
        "name": "Постановление Правительства № 985",
        "content": "Перечень что подлежит экспертизе",
        "url": "http://government.ru/docs/all/132984/"
    },
    "ПП_1431": {
        "name": "Постановление № 1431",
        "content": "Порядок выдачи ЗОС",
        "url": "http://government.ru/docs/all/135829/"
    },
    "Приказ_783": {
        "name": "Приказ Минстроя № 783/пр",
        "content": "Строительный контроль и надзор",
        "year": "2020"
    },
    "Приказ_926": {
        "name": "Приказ № 926/пр",
        "content": "ТИМ/BIM требования",
        "year": "2021"
    },
    "СП_48": {
        "name": "СП 48.13330.2019",
        "content": "Организация строительства",
        "url": "https://docs.cntd.ru/document/564477582"
    },
    "РД_11_02": {
        "name": "РД-11-02-2006",
        "content": "Состав и порядок ведения исполнительной документации",
        "status": "Действует"
    },
    "ПП_815": {
        "name": "Постановление № 815",
        "content": "Какие разделы ПД обязательны",
        "year": "2020"
    },
    "ГОСТ_57580": {
        "name": "ГОСТ Р 57580.1-2017",
        "content": "Требования к информационным моделям (BIM)",
        "series": "ГОСТ Р 57580 (серия)"
    }
}

# === ЧЕК-ЛИСТ ЕЖЕДНЕВНЫХ ПРОВЕРОК ===
DAILY_CHECKLIST = [
    "✓ Действующее разрешение на строительство (РНС)",
    "✓ ПД прошла экспертизу (положительное заключение)",
    "✓ Членство генподрядчика в СРО",
    "✓ Ведение исполнительной документации (акты, журналы)",
    "✓ Назначены лица по технадзору и стройконтролю",
    "✓ Для промки: регистрация ОПО, наличие СЗЗ",
    "✓ Журнал входного контроля материалов",
    "✓ Допуски специалистов (сварщики, стропальщики, крановщики)",
    "✓ Подписание актов КС-2, КС-3 ежемесячно"
]

# === ТРЕНДЫ 2025-2027 ===
TRENDS_2025_2027 = {
    "реестровая_модель": {
        "status": "Полный переход через Госуслуги",
        "timeline": "2025-2026"
    },
    "ТИМ_Level2": {
        "status": "Обязательно с 2027 для всех объектов",
        "date": "01.01.2027"
    },
    "ESG": {
        "name": "Зелёное строительство",
        "standards": ["LEED", "BREEAM", "Зелёные стандарты РФ"],
        "trend": "Растущий"
    },
    "роботизация": {
        "examples": ["Дроны для стройконтроля", "Роботы для кладки", "3D-печать домов"],
        "status": "Допускается как инструмент контроля"
    },
    "страхование": {
        "name": "Обязательное страхование гражданской ответственности застройщика",
        "timeline": "С 2025 для всех (не только 214-ФЗ)"
    }
}

# === ЭКСПОРТНАЯ ФУНКЦИЯ ===
def get_all_regulations():
    """Получить все нормативы в структурированном виде"""
    return {
        "federal_laws": FEDERAL_LAWS,
        "procedures_2025": MANDATORY_PROCEDURES_2025,
        "sro": SRO_REQUIREMENTS,
        "tim_bim": TIM_BIM_REQUIREMENTS,
        "pricing": PRICING_2025,
        "industrial": INDUSTRIAL_CONSTRUCTION,
        "civil": CIVIL_CONSTRUCTION,
        "commercial": COMMERCIAL_CONSTRUCTION,
        "key_regulations": KEY_REGULATIONS_2025,
        "checklist": DAILY_CHECKLIST,
        "trends": TRENDS_2025_2027
    }

def search_regulation(query: str) -> dict:
    """Поиск по базе нормативов"""
    results = []
    query_lower = query.lower()

    # Поиск в федеральных законах
    for code, data in FEDERAL_LAWS.items():
        if query_lower in code.lower() or query_lower in data['title'].lower():
            results.append({
                'type': 'Федеральный закон',
                'code': code,
                'data': data
            })

    # Поиск в ключевых нормативах
    for code, data in KEY_REGULATIONS_2025.items():
        if query_lower in data['name'].lower() or query_lower in data['content'].lower():
            results.append({
                'type': 'Нормативный документ',
                'code': code,
                'data': data
            })

    return results
