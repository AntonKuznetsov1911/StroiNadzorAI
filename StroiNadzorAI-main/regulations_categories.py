"""
–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤ –¥–ª—è —É–¥–æ–±–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ 27 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ —Ç–∏–ø–∞–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é
"""

from telegram import InlineKeyboardButton, InlineKeyboardMarkup

# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤
REGULATIONS_CATEGORIES = {
    "foundations": {
        "name": "üèóÔ∏è –§—É–Ω–¥–∞–º–µ–Ω—Ç—ã –∏ –æ—Å–Ω–æ–≤–∞–Ω–∏—è",
        "description": "–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–∏–π –∑–¥–∞–Ω–∏–π –∏ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–π",
        "regulations": [
            {
                "code": "–°–ü 22.13330.2016",
                "name": "–û—Å–Ω–æ–≤–∞–Ω–∏—è –∑–¥–∞–Ω–∏–π –∏ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–π",
                "tags": ["—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç", "–æ—Å–Ω–æ–≤–∞–Ω–∏–µ", "–≥—Ä—É–Ω—Ç", "–Ω–µ—Å—É—â–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å"]
            },
            {
                "code": "–°–ü 24.13330.2021",
                "name": "–°–≤–∞–π–Ω—ã–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç—ã",
                "tags": ["—Å–≤–∞–∏", "—Å–≤–∞–π–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç", "–∑–∞–±–∏–≤–Ω—ã–µ —Å–≤–∞–∏", "–±—É—Ä–æ–Ω–∞–±–∏–≤–Ω—ã–µ"]
            },
            {
                "code": "–°–ü 50-101-2004",
                "name": "–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ—Å–Ω–æ–≤–∞–Ω–∏–π –∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–≤",
                "tags": ["–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ", "—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ", "—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç"]
            }
        ]
    },
    "structures": {
        "name": "üèõÔ∏è –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
        "description": "–ñ–µ–ª–µ–∑–æ–±–µ—Ç–æ–Ω–Ω—ã–µ, —Å—Ç–∞–ª—å–Ω—ã–µ –∏ –∫–∞–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
        "regulations": [
            {
                "code": "–°–ü 63.13330.2018",
                "name": "–ë–µ—Ç–æ–Ω–Ω—ã–µ –∏ –∂–µ–ª–µ–∑–æ–±–µ—Ç–æ–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
                "tags": ["–±–µ—Ç–æ–Ω", "–∂–µ–ª–µ–∑–æ–±–µ—Ç–æ–Ω", "–∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ", "–ø—Ä–æ—á–Ω–æ—Å—Ç—å"]
            },
            {
                "code": "–°–ü 16.13330.2017",
                "name": "–°—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
                "tags": ["—Å—Ç–∞–ª—å", "–º–µ—Ç–∞–ª–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏", "—Å–≤–∞—Ä–∫–∞"]
            },
            {
                "code": "–°–ü 64.13330.2017",
                "name": "–î–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
                "tags": ["–¥–µ—Ä–µ–≤–æ", "–±—Ä—É—Å", "–¥–æ—Å–∫–∞"]
            },
            {
                "code": "–°–ü 70.13330.2012",
                "name": "–ù–µ—Å—É—â–∏–µ –∏ –æ–≥—Ä–∞–∂–¥–∞—é—â–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
                "tags": ["–Ω–µ—Å—É—â–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏", "–æ–≥—Ä–∞–∂–¥–∞—é—â–∏–µ"]
            },
            {
                "code": "–°–ü 28.13330.2017",
                "name": "–ó–∞—â–∏—Ç–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –æ—Ç –∫–æ—Ä—Ä–æ–∑–∏–∏",
                "tags": ["–∫–æ—Ä—Ä–æ–∑–∏—è", "–∑–∞—â–∏—Ç–∞", "–≥–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è"]
            }
        ]
    },
    "thermal": {
        "name": "üå°Ô∏è –¢–µ–ø–ª–æ—Ç–µ—Ö–Ω–∏–∫–∞",
        "description": "–¢–µ–ø–ª–æ–∑–∞—â–∏—Ç–∞, –∏–∑–æ–ª—è—Ü–∏—è, —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
        "regulations": [
            {
                "code": "–°–ü 50.13330.2012",
                "name": "–¢–µ–ø–ª–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ –∑–¥–∞–Ω–∏–π",
                "tags": ["—Ç–µ–ø–ª–æ—Ç–µ—Ö–Ω–∏–∫–∞", "—É—Ç–µ–ø–ª–µ–Ω–∏–µ", "—Ç–µ–ø–ª–æ–∑–∞—â–∏—Ç–∞"]
            },
            {
                "code": "–°–ü 23-101-2004",
                "name": "–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ø–ª–æ–≤–æ–π –∑–∞—â–∏—Ç—ã –∑–¥–∞–Ω–∏–π",
                "tags": ["–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ", "—Ç–µ–ø–ª–æ—Ç–µ—Ö–Ω–∏–∫–∞", "—ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"]
            },
            {
                "code": "–°–ü 17.13330.2017",
                "name": "–ö—Ä–æ–≤–ª–∏",
                "tags": ["–∫—Ä–æ–≤–ª—è", "–∫—Ä—ã—à–∞", "–≥–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è", "—É—Ç–µ–ø–ª–µ–Ω–∏–µ"]
            }
        ]
    },
    "engineering": {
        "name": "‚ö° –ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —Å–µ—Ç–∏",
        "description": "–í–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ, –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è, –æ—Ç–æ–ø–ª–µ–Ω–∏–µ, —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ",
        "regulations": [
            {
                "code": "–°–ü 60.13330.2020",
                "name": "–û—Ç–æ–ø–ª–µ–Ω–∏–µ, –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è –∏ –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
                "tags": ["–æ—Ç–æ–ø–ª–µ–Ω–∏–µ", "–≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è", "–∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "–û–í–ö–í"]
            },
            {
                "code": "–°–ü 30.13330.2020",
                "name": "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤–æ–¥–æ–ø—Ä–æ–≤–æ–¥ –∏ –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è",
                "tags": ["–≤–æ–¥–æ–ø—Ä–æ–≤–æ–¥", "–∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è", "—Å–µ—Ç–∏"]
            },
            {
                "code": "–°–ü 52.13330.2016",
                "name": "–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ",
                "tags": ["–æ—Å–≤–µ—â–µ–Ω–∏–µ", "—Å–≤–µ—Ç", "—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ"]
            }
        ]
    },
    "fire_safety": {
        "name": "üî• –ü–æ–∂–∞—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
        "description": "–°–∏—Å—Ç–µ–º—ã –ø–æ–∂–∞—Ä–æ—Ç—É—à–µ–Ω–∏—è, —ç–≤–∞–∫—É–∞—Ü–∏—è, –æ–≥–Ω–µ—Å—Ç–æ–π–∫–æ—Å—Ç—å",
        "regulations": [
            {
                "code": "–°–ü 2.13130.2020",
                "name": "–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –æ–≥–Ω–µ—Å—Ç–æ–π–∫–æ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞—â–∏—Ç—ã",
                "tags": ["–ø–æ–∂–∞—Ä", "–æ–≥–Ω–µ—Å—Ç–æ–π–∫–æ—Å—Ç—å", "–∑–∞—â–∏—Ç–∞"]
            },
            {
                "code": "–°–ü 4.13130.2013",
                "name": "–°–∏—Å—Ç–µ–º—ã –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∂–∞—Ä–Ω–æ–π –∑–∞—â–∏—Ç—ã",
                "tags": ["–ø–æ–∂–∞—Ä–æ—Ç—É—à–µ–Ω–∏–µ", "—Å–ø—Ä–∏–Ω–∫–ª–µ—Ä—ã", "—Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã"]
            }
        ]
    },
    "inspection": {
        "name": "üîç –û–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å",
        "description": "–î–µ—Ñ–µ–∫—Ç–æ—Å–∫–æ–ø–∏—è, –∏—Å–ø—ã—Ç–∞–Ω–∏—è, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ",
        "regulations": [
            {
                "code": "–°–ü 13-102-2003",
                "name": "–ü—Ä–∞–≤–∏–ª–∞ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–µ—Å—É—â–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π",
                "tags": ["–æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ", "–¥–µ—Ñ–µ–∫—Ç—ã", "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"]
            },
            {
                "code": "–ì–û–°–¢ 31937-2011",
                "name": "–ó–¥–∞–Ω–∏—è –∏ —Å–æ–æ—Ä—É–∂–µ–Ω–∏—è. –ü—Ä–∞–≤–∏–ª–∞ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è",
                "tags": ["–æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ", "—ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞", "–¥–µ—Ñ–µ–∫—Ç—ã"]
            },
            {
                "code": "–°–ü 255.1325800.2016",
                "name": "–ó–¥–∞–Ω–∏—è –∏ —Å–æ–æ—Ä—É–∂–µ–Ω–∏—è. –ü—Ä–∞–≤–∏–ª–∞ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏",
                "tags": ["—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è", "–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ", "—Ä–µ–º–æ–Ω—Ç"]
            },
            {
                "code": "–ì–û–°–¢ 10180-2012",
                "name": "–ë–µ—Ç–æ–Ω—ã. –ú–µ—Ç–æ–¥—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ—á–Ω–æ—Å—Ç–∏",
                "tags": ["–∏—Å–ø—ã—Ç–∞–Ω–∏—è", "–ø—Ä–æ—á–Ω–æ—Å—Ç—å", "–±–µ—Ç–æ–Ω", "–∫–æ–Ω—Ç—Ä–æ–ª—å"]
            },
            {
                "code": "–ì–û–°–¢ 22690-2015",
                "name": "–ë–µ—Ç–æ–Ω—ã. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—á–Ω–æ—Å—Ç–∏ –Ω–µ—Ä–∞–∑—Ä—É—à–∞—é—â–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏",
                "tags": ["–Ω–µ—Ä–∞–∑—Ä—É—à–∞—é—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å", "–ø—Ä–æ—á–Ω–æ—Å—Ç—å", "–∏—Å–ø—ã—Ç–∞–Ω–∏—è"]
            },
            {
                "code": "–ì–û–°–¢ 23055-2020",
                "name": "–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–µ—Ä–∞–∑—Ä—É—à–∞—é—â–∏–π. –°–≤–∞—Ä–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è",
                "tags": ["–¥–µ—Ñ–µ–∫—Ç–æ—Å–∫–æ–ø–∏—è", "—Å–≤–∞—Ä–∫–∞", "–∫–æ–Ω—Ç—Ä–æ–ª—å"]
            },
            {
                "code": "–°–ü 48.13330.2019",
                "name": "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞",
                "tags": ["–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è", "–∫–æ–Ω—Ç—Ä–æ–ª—å", "–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–±–æ—Ç"]
            }
        ]
    },
    "accessibility": {
        "name": "‚ôø –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å",
        "description": "–î–æ—Å—Ç—É–ø–Ω–∞—è —Å—Ä–µ–¥–∞ –¥–ª—è –º–∞–ª–æ–º–æ–±–∏–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø –Ω–∞—Å–µ–ª–µ–Ω–∏—è",
        "regulations": [
            {
                "code": "–°–ü 59.13330.2020",
                "name": "–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∑–¥–∞–Ω–∏–π –¥–ª—è –º–∞–ª–æ–º–æ–±–∏–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø",
                "tags": ["–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å", "–∏–Ω–≤–∞–ª–∏–¥—ã", "–ú–ì–ù", "–¥–æ—Å—Ç—É–ø–Ω–∞—è —Å—Ä–µ–¥–∞"]
            }
        ]
    }
}

def get_categories_keyboard():
    """–°–æ–∑–¥–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤"""
    keyboard = []

    for category_id, category_data in REGULATIONS_CATEGORIES.items():
        keyboard.append([
            InlineKeyboardButton(
                category_data["name"],
                callback_data=f"cat_{category_id}"
            )
        ])

    keyboard.append([InlineKeyboardButton("üìö –í—Å–µ –Ω–æ—Ä–º–∞—Ç–∏–≤—ã (—Å–ø–∏—Å–æ–∫)", callback_data="cat_all")])

    return InlineKeyboardMarkup(keyboard)

def get_regulations_by_category(category_id):
    """–ü–æ–ª—É—á–∏—Ç—å –Ω–æ—Ä–º–∞—Ç–∏–≤—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    if category_id not in REGULATIONS_CATEGORIES:
        return None

    category = REGULATIONS_CATEGORIES[category_id]
    regulations = category["regulations"]

    text = f"**{category['name']}**\n\n"
    text += f"_{category['description']}_\n\n"

    for reg in regulations:
        text += f"üìÑ **{reg['code']}**\n"
        text += f"{reg['name']}\n\n"

    return text

def search_regulations_by_keyword(keyword):
    """–ü–æ–∏—Å–∫ –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É"""
    keyword_lower = keyword.lower()
    results = []

    for category_id, category_data in REGULATIONS_CATEGORIES.items():
        for reg in category_data["regulations"]:
            # –ü–æ–∏—Å–∫ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏, –∫–æ–¥–µ –∏ —Ç–µ–≥–∞—Ö
            if (keyword_lower in reg["code"].lower() or
                keyword_lower in reg["name"].lower() or
                any(keyword_lower in tag.lower() for tag in reg["tags"])):

                results.append({
                    "category": category_data["name"],
                    "code": reg["code"],
                    "name": reg["name"]
                })

    return results

def get_all_regulations_text():
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤"""
    text = "üìö **–í–°–ï –ù–û–†–ú–ê–¢–ò–í–´ (27 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)**\n\n"

    for category_data in REGULATIONS_CATEGORIES.values():
        text += f"**{category_data['name']}**\n\n"

        for reg in category_data["regulations"]:
            text += f"‚Ä¢ {reg['code']} - {reg['name']}\n"

        text += "\n"

    text += "_–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:_\n/regulations_menu"

    return text

def get_related_regulations(current_code):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –Ω–æ—Ä–º–∞—Ç–∏–≤—ã"""
    # –ù–∞–π—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–µ–∫—É—â–µ–≥–æ –Ω–æ—Ä–º–∞—Ç–∏–≤–∞
    current_category = None
    for category_id, category_data in REGULATIONS_CATEGORIES.items():
        for reg in category_data["regulations"]:
            if reg["code"] == current_code:
                current_category = category_id
                break

    if not current_category:
        return []

    # –í–µ—Ä–Ω—É—Ç—å –≤—Å–µ –Ω–æ—Ä–º–∞—Ç–∏–≤—ã –∏–∑ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ
    related = []
    for reg in REGULATIONS_CATEGORIES[current_category]["regulations"]:
        if reg["code"] != current_code:
            related.append(f"{reg['code']} - {reg['name']}")

    return related
