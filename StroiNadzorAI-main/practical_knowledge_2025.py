"""
Практические знания для строительной площадки 2025
HSE, технологии, сметы, юридические тонкости, управление проектами
"""

# === 1. ОХРАНА ТРУДА И ТЕХНИКА БЕЗОПАСНОСТИ (HSE) ===

HSE_REQUIREMENTS = {
    "работа_на_высоте": {
        "regulation": "Приказ Минтруда № 782н",
        "url": "https://docs.cntd.ru/document/573276526",
        "key_points": {
            "определение": "Работы на высоте > 1.8 м от поверхности",
            "группы_безопасности": {
                "1_группа": "Работники под непосредственным контролем",
                "2_группа": "Мастера, бригадиры (стаж > 1 года)",
                "3_группа": "Ответственные за безопасность"
            },
            "СИЗ_обязательные": [
                "Страховочная привязь (ГОСТ Р ЕН 361)",
                "Анкерная линия или точка крепления",
                "Каска с подбородочным ремнем",
                "Амортизатор (при высоте > 6 м)"
            ],
            "наряд_допуск": {
                "когда_нужен": [
                    "Высота > 5 м без защитных ограждений",
                    "Работы на крышах с уклоном > 20°",
                    "Работы на высоте при неблагоприятных условиях"
                ],
                "срок_действия": "1 смена или 8 часов",
                "кто_выдает": "Ответственный за безопасность работ"
            },
            "анкерные_линии": {
                "типы": ["Вертикальные", "Горизонтальные"],
                "прочность": "Не менее 2200 кгс для одного работника",
                "проверка": "Перед каждым использованием визуально",
                "испытания": "1 раз в 12 месяцев"
            }
        },
        "частые_нарушения": [
            "Работа без привязи",
            "Отсутствие наряда-допуска",
            "Крепление страховки к неиспытанным конструкциям",
            "Работа одного человека на высоте"
        ],
        "штрафы": "От 130 000 до 150 000 руб. на юрлицо + приостановка работ"
    },

    "электробезопасность": {
        "regulation": "Правила по охране труда при эксплуатации электроустановок (Приказ № 903н)",
        "группы_допуска": {
            "I": "Неэлектротехнический персонал (инструктаж)",
            "II": "Электромонтеры до 1000 В",
            "III": "Электромонтеры до и выше 1000 В",
            "IV": "Ответственные за электрохозяйство",
            "V": "Главные энергетики"
        },
        "временные_электросети": {
            "требования": [
                "Кабель не менее 4x4 мм² для 380В",
                "УЗО на каждый щиток (30 мА)",
                "Заземление контура не более 4 Ом",
                "Высота подвеса кабеля не менее 2.5 м"
            ],
            "запрещено": [
                "Использовать скрутки вместо клемм",
                "Подвешивать кабель на арматуру",
                "Прокладка кабеля по земле без защиты"
            ]
        },
        "наряд_допуск_электро": {
            "когда": "Работы в действующих электроустановках",
            "минимум_людей": "Бригада не менее 2 человек",
            "наблюдающий": "Обязательно с группой не ниже III"
        }
    },

    "погрузочно_разгрузочные_работы": {
        "regulation": "Приказ Минтруда № 274н, ПОТ при погрузке",
        "строповка": {
            "схемы": {
                "обвязка_в_обхват": "Для грузов с гладкой поверхностью",
                "четырехветвевой_строп": "Для длинномерных грузов",
                "траверса": "Для хрупких и длинных конструкций"
            },
            "углы_строп": {
                "оптимально": "45-60° к горизонту",
                "максимум": "90° (вертикально) - нагрузка удваивается",
                "запрещено": "> 90° (стропы работают на разрыв)"
            },
            "коэффициенты_запаса": {
                "новый_строп": "Коэффициент запаса прочности 6:1",
                "бракованный": "Порван хотя бы один пруток - строп утилизировать"
            }
        },
        "сигналы": {
            "основные_жесты": {
                "поднять": "Рука вверх, ладонь вперед",
                "опустить": "Рука вниз, ладонь вниз",
                "стоп": "Обе руки скрещены над головой",
                "опасность": "Резкие движения руками"
            },
            "радиосвязь": "Обязательна при работе на расстоянии >30 м"
        },
        "допуски_специалистов": {
            "стропальщик": "Удостоверение + ежегодная проверка знаний",
            "крановщик": "Удостоверение Ростехнадзора + медосмотр",
            "сигнальщик": "Обучение + инструктаж"
        }
    },

    "СИЗ_на_площадке": {
        "минимальный_набор": [
            "Каска (ГОСТ 12.4.207, срок службы 3 года)",
            "Спецодежда сигнальная класс 2-3 (ГОСТ 12.4.281)",
            "Спецобувь с защитным подноском 200 Дж",
            "Перчатки (от механических воздействий)"
        ],
        "дополнительные": {
            "шум_>80дБ": "Наушники или беруши",
            "сварка": "Маска, краги, спецодежда для сварщиков",
            "пыль": "Респиратор не ниже FFP2"
        }
    }
}

# === 2. ТЕХНОЛОГИЯ СТРОИТЕЛЬНОГО ПРОИЗВОДСТВА ===

CONSTRUCTION_TECHNOLOGY = {
    "бетонные_работы": {
        "набор_прочности": {
            "нормальные_условия": {
                "температура": "+20°C, влажность 90-100%",
                "сроки": {
                    "3_суток": "30% прочности",
                    "7_суток": "70% прочности (можно снимать опалубку)",
                    "28_суток": "100% проектной прочности"
                }
            },
            "зимнее_бетонирование": {
                "при_минус_10": {
                    "с_прогревом": "7-10 суток до 70% + противоморозные добавки",
                    "без_прогрева": "Запрещено, бетон замерзнет",
                    "добавки": "Нитрит натрия 3-5% от массы цемента"
                },
                "методы_прогрева": {
                    "электродный": "Арматура + электроды, 60-80В переменный ток",
                    "тепловые_пушки": "В тепляках, 15-25°C внутри",
                    "термоматы": "Для горизонтальных поверхностей",
                    "провод_ПНСВ": "1.2 мм, 20-30 м на 1 м³"
                },
                "расчет_электроэнергии": "Примерно 80-120 кВт·ч на 1 м³"
            }
        },
        "контроль_прочности": {
            "методы": {
                "разрушающий": "Образцы-кубики 100x100x100 мм (ГОСТ 10180)",
                "неразрушающий": "Склерометр (молоток Шмидта), ультразвук"
            },
            "отбор_проб": "Не реже 1 пробы на 100 м³ однородного бетона"
        },
        "допуски_укладки": {
            "время_до_укладки": "Не более 1.5-2 часов с момента изготовления",
            "толщина_слоя": "При виброуплотнении не более 40-50 см",
            "высота_сброса": "Не более 2 м (иначе расслоение)"
        }
    },

    "арматурные_работы": {
        "нахлесты": {
            "расчет": "Длина нахлеста = диаметр арматуры × коэффициент",
            "коэффициенты": {
                "A400_сжатие": "30d (для d=16 мм = 480 мм)",
                "A400_растяжение": "40d (для d=16 мм = 640 мм)",
                "A500_растяжение": "50d (для d=16 мм = 800 мм)"
            },
            "правило": "Нахлесты в одном сечении не более 50% стержней"
        },
        "защитный_слой": {
            "для_плит": "15-20 мм (фиксаторы 'стульчики')",
            "для_балок": "25-30 мм",
            "для_колонн": "30-40 мм",
            "фундаменты_на_грунте": "70 мм (бетонная подготовка обязательна)"
        },
        "вязка_vs_сварка": {
            "вязка": "Основной метод, проволока ⌀1.2-1.6 мм",
            "сварка": "Только для свариваемых классов (A400C, A500C)",
            "запрещено_сваривать": "Обычную A400 (A-III) без индекса 'C'"
        }
    },

    "входной_контроль_материалов": {
        "кирпич": {
            "стандарт": "ГОСТ 530-2012",
            "допуски_геометрии": {
                "длина": "±4 мм",
                "ширина": "±3 мм",
                "толщина": "±2 мм",
                "отклонение_граней": "не более 3 мм"
            },
            "брак": [
                "Отбитости углов > 1.5 см",
                "Сквозные трещины",
                "Известковые включения (дутики)"
            ],
            "проверка": "Не менее 5 шт. из каждой партии"
        },
        "бетон": {
            "документы": "Паспорт на каждую машину, отметка о времени",
            "проверка_осадки_конуса": {
                "метод": "ГОСТ 10181",
                "допуск": "±2 см от заявленной марки подвижности"
            }
        },
        "арматура": {
            "документы": "Сертификат соответствия + маркировка",
            "проверка": "Визуально на ржавчину (рыхлая ржавчина > 0.5 мм - брак)"
        }
    },

    "ППР_и_ТК": {
        "что_такое": {
            "ППР": "Проект производства работ - общий документ на объект",
            "ТК": "Технологическая карта - детализация на вид работ"
        },
        "обязательные_разделы_ППР": [
            "Календарный план",
            "Стройгенплан",
            "График поступления материалов",
            "График движения рабочих",
            "Мероприятия по охране труда"
        ],
        "когда_обязательны": {
            "ППР": "Для всех объектов с экспертизой ПД",
            "ТК": "На особо опасные или технически сложные работы"
        }
    }
}

# === 3. СМЕТНОЕ ДЕЛО И ФИНАНСЫ ===

ESTIMATING_FINANCE = {
    "КС_2_КС_3": {
        "отличия": {
            "КС-2": "Акт о приемке выполненных работ (форма КС-2)",
            "КС-3": "Справка о стоимости выполненных работ (форма КС-3)"
        },
        "порядок_оформления": [
            "1. Подрядчик заполняет КС-2 с объемами",
            "2. Технадзор проверяет и подписывает КС-2",
            "3. Подрядчик составляет КС-3 на основе КС-2",
            "4. Заказчик подписывает КС-3 и оплачивает"
        ],
        "типичные_ошибки": [
            "КС-2 без исполнительной документации",
            "Разные объемы в КС-2 и КС-3",
            "КС-3 подписан раньше КС-2",
            "Отсутствие актов освидетельствования скрытых работ"
        ],
        "выполнение_по_факту_vs_по_смете": {
            "по_смете": "Оплата по ценам сметы независимо от фактических объемов",
            "по_факту": "Оплата за реально выполненные объемы (требует обмеров)",
            "в_договоре": "Обязательно прописать какой вариант"
        }
    },

    "давальческие_материалы": {
        "что_это": "Материалы заказчика, переданные подрядчику для работ",
        "форма_М_29": {
            "название": "Отчет о расходе материалов в строительстве",
            "периодичность": "Ежемесячно",
            "содержание": [
                "Остаток на начало месяца",
                "Получено от заказчика",
                "Израсходовано в производстве",
                "Остаток на конец месяца"
            ]
        },
        "налоговые_риски": {
            "НДС": "Давальческие материалы не облагаются НДС у подрядчика",
            "но": "Если продать их или списать с излишками - НДС 20%",
            "безопасная_норма": "Списание в пределах сметных норм расхода"
        },
        "ответственность_за_утрату": "Подрядчик возмещает стоимость по рыночным ценам"
    },

    "непредвиденные_расходы": {
        "что_входит": {
            "в_смете": "1-3% от сметной стоимости (резерв на мелкие отклонения)",
            "примеры": [
                "Небольшое увеличение объемов",
                "Замена материала на аналогичный",
                "Непредвиденные доп. крепления"
            ]
        },
        "что_НЕ_входит": [
            "Изменение проекта",
            "Дополнительные разделы работ",
            "Брак и переделки"
        ],
        "доп_соглашение_нужно_когда": [
            "Изменение объемов > 10%",
            "Новые виды работ не в смете",
            "Изменение проектных решений"
        ]
    },

    "коммерческая_смета": {
        "отличие_от_ГЭСН": "ГЭСН - государственная база, коммерческая - договорная",
        "структура": [
            "Прямые затраты (материалы, ЗП, механизмы)",
            "Накладные расходы (15-20%)",
            "Сметная прибыль (60-80%)",
            "НДС (20%)"
        ],
        "проверка_заказчиком": "Сравнение с аналогичными проектами, проверка расценок"
    }
}

# === 4. ЮРИДИЧЕСКИЕ ТОНКОСТИ ===

LEGAL_ISSUES = {
    "сроки_и_неустойки": {
        "основания_ГК_РФ": {
            "ст_708": "Сроки выполнения работ",
            "ст_716": "Право подрядчика приостановить работы",
            "ст_719": "Качество работ",
            "ст_720": "Ответственность за ненадлежащее качество"
        },
        "фронт_работ_не_передан": {
            "действия_подрядчика": [
                "1. Письмо заказчику с требованием передать фронт (с описью)",
                "2. Если нет ответа 3-7 дней → второе письмо с предупреждением",
                "3. Приказ о приостановке работ со ссылкой на ст. 716 ГК РФ",
                "4. Уведомление о продлении сроков на период простоя"
            ],
            "документы": [
                "Письма с описью вручения или email с подтверждением",
                "Протокол осмотра площадки (комиссия, фото)",
                "Приказ по организации"
            ],
            "неустойка": "Заказчик обязан компенсировать простой подрядчика"
        },
        "срыв_сроков_подрядчиком": {
            "неустойка": "Обычно 0.1% от стоимости за каждый день просрочки",
            "ограничение": "Не более 10% от цены договора (если не указано иное)",
            "основание": "ст. 330, 331 ГК РФ"
        }
    },

    "скрытые_работы": {
        "что_это": "Работы, результаты которых невозможно проверить после их выполнения",
        "примеры": [
            "Арматурный каркас перед бетонированием",
            "Гидроизоляция фундамента перед обратной засыпкой",
            "Скрытая прокладка коммуникаций"
        ],
        "процедура": {
            "уведомление": "Подрядчик уведомляет технадзор за 2-3 дня",
            "осмотр": "Совместный осмотр с фотофиксацией",
            "акт": "Акт освидетельствования скрытых работ (форма произвольная или КС-2)",
            "если_не_пришли": "Составить односторонний акт + пригласить независимого эксперта"
        },
        "технадзор_отказывается_подписывать": {
            "если_уже_залито": {
                "плохой_сценарий": "Вскрытие конструкции по требованию заказчика",
                "решение": [
                    "1. Письменное обоснование отказа от технадзора",
                    "2. Экспертиза неразрушающими методами (склерометр, УЗ-контроль)",
                    "3. При подтверждении качества - акт задним числом не подписывают, но претензий нет"
                ],
                "ответственность": "Если качество не соответствует - подрядчик за свой счет вскрывает"
            },
            "профилактика": [
                "Всегда уведомлять письменно с описью или email",
                "Фотофиксация каждого этапа",
                "Не закрывать работы без подписи"
            ]
        }
    },

    "претензионная_работа": {
        "письмо_о_приостановке_работ": {
            "структура": [
                "Кому (ген. директору заказчика)",
                "От кого (ген. директора подрядчика)",
                "Дата и номер",
                "Тема: Уведомление о приостановке работ",
                "Основание: ст. 716 ГК РФ + конкретная причина",
                "Дата приостановки",
                "Требование об устранении причин",
                "Подпись руководителя"
            ],
            "пример": '''
Уважаемый [ФИО]!

На основании ст. 716 ГК РФ уведомляем о приостановке работ на объекте [название]
с [дата] по причине непередачи фронта работ согласно п. 3.2 Договора №[номер].

Неоднократные обращения от [даты] и [даты] не привели к устранению нарушений.

Требуем в срок до [дата] обеспечить передачу фронта работ.

Приложения: копии писем, протокол осмотра.
            '''
        },
        "претензия_по_оплате": {
            "срок_ответа": "30 дней с момента получения (если не указано иное в договоре)",
            "обязательно": "До обращения в суд (иначе суд вернет иск)"
        }
    },

    "изменение_объемов": {
        "менее_10_процентов": "Можно списать в непредвиденные расходы",
        "более_10_процентов": "Обязательно доп. соглашение к договору",
        "новый_вид_работ": "Всегда доп. соглашение, даже если сумма маленькая"
    }
}

# === 5. УПРАВЛЕНИЕ ПРОЕКТАМИ И SOFT SKILLS ===

PROJECT_MANAGEMENT = {
    "планирование": {
        "график_Ганта": {
            "что_это": "Линейный календарный график с задачами по оси Y, временем по оси X",
            "преимущества": "Наглядность, легко обновлять",
            "недостатки": "Не показывает зависимости между задачами",
            "ПО": ["MS Project", "Primavera P6", "Excel (простые проекты)"]
        },
        "сетевой_график": {
            "что_это": "Граф с узлами (работы) и стрелками (зависимости)",
            "критический_путь": "Последовательность работ с нулевым запасом времени",
            "используется_для": "Оптимизации сроков и ресурсов"
        },
        "расчет_потребности_в_людях": {
            "формула": "Количество = Объем работ (чел·час) / (Длительность (дней) × 8 часов)",
            "пример": "Кладка 100 м³ кирпича, норма 1.5 чел·ч на 1 м³ → 100×1.5=150 чел·ч. Срок 10 дней → 150/(10×8) = 1.875 ≈ 2 каменщика",
            "коэффициент_выполнения_норм": "Реальность: умножить на 1.2-1.5 (не все работают по нормам)"
        }
    },

    "протоколы_совещаний": {
        "зачем": [
            "Юридическая фиксация устных договоренностей",
            "Доказательство в спорах",
            "Контроль исполнения поручений"
        ],
        "структура": {
            "шапка": "Дата, время, место, участники",
            "повестка": "Список вопросов",
            "решения": "Конкретные формулировки: 'Кто-Что-Когда'",
            "подписи": "Все участники (или пометка 'Отказался подписать')"
        },
        "оформление": {
            "в_день_совещания": "Протокол должен быть составлен в тот же день",
            "рассылка": "Email всем участникам + бумажный экземпляр заказчику",
            "хранение": "В деле объекта, минимум 5 лет"
        },
        "пример_формулировки": {
            "плохо": "Решили ускорить работы",
            "хорошо": "Решили: Иванов И.И. (прораб) обеспечить выход 5 каменщиков до 15.11.2025. Ответственный: Петров П.П."
        }
    },

    "взаимодействие_на_стройке": {
        "цепочка_команд": "Заказчик → ГИП/Технадзор → ГАП/Прораб → Мастер → Рабочие",
        "запрещено": "Прямые указания заказчика рабочим в обход прораба",
        "устные_указания": {
            "правило": "Любое устное указание подтверждать письменно",
            "способы": [
                "Email с пометкой 'Подтверждаю устную договоренность от [дата]'",
                "Служебная записка",
                "Запись в журнал производства работ"
            ]
        }
    },

    "конфликты_на_площадке": {
        "с_заказчиком": {
            "причины": "Недопонимание сроков, качества, объемов",
            "решение": "Совещание с протоколом, привлечение вышестоящих руководителей"
        },
        "с_субподрядчиком": {
            "причины": "Срыв сроков, низкое качество",
            "решение": "Письменная претензия, штрафы по договору, замена бригады"
        },
        "между_рабочими": {
            "причины": "Личные, алкоголь, национальные",
            "решение": "Разведение по разным участкам, увольнение зачинщиков"
        }
    }
}

# === ЭКСПОРТНАЯ ФУНКЦИЯ ===

def get_all_practical_knowledge():
    """Получить всю практическую базу знаний"""
    return {
        "hse": HSE_REQUIREMENTS,
        "technology": CONSTRUCTION_TECHNOLOGY,
        "estimating": ESTIMATING_FINANCE,
        "legal": LEGAL_ISSUES,
        "management": PROJECT_MANAGEMENT
    }

def search_practical(query: str) -> list:
    """Поиск по практической базе"""
    results = []
    query_lower = query.lower()

    all_data = get_all_practical_knowledge()

    for category, data in all_data.items():
        for key, value in data.items():
            if query_lower in key.lower() or query_lower in str(value).lower():
                results.append({
                    'category': category,
                    'key': key,
                    'data': value
                })

    return results
